<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bienvenido a Exponiendo Tacna</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .hero-section {
            background-image: url('/static/img/hero-background.jpg');
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>

    <header class="main-header">
        <div class="container">
            <a href="/" class="logo">Exponiendo Tacna</a>
            <nav class="main-nav">
                <a href="#registro" class="btn btn-primary">Crear Cuenta</a>
                <a href="#login" class="btn btn-secondary">Iniciar Sesi√≥n</a>
            </nav>
        </div>
    </header>

    <main>
        <section class="hero-section">
            <div class="hero-overlay"></div>
            <div class="container hero-content">
                <h1>Tu Archivo Privado de Momentos √çntimos</h1>
                <p>Descubre, colecciona y organiza contenido exclusivo. √önete a nuestra comunidad y empieza a explorar.</p>
                <a href="#registro" class="btn btn-primary btn-lg">√önete Gratis</a>
            </div>
        </section>

        <section class="featured-albums">
            <div class="container">
                <h2 class="section-title">Los M√°s Vistos de la Comunidad</h2>
                <p class="section-subtitle">El contenido que est√° marcando tendencia ahora mismo.</p>
                <div class="album-grid" id="album-grid-container">
                    <p class="loading-message">Cargando los √°lbumes m√°s populares...</p>
                </div>
            </div>
        </section>

        <section class="features-section">
            <div class="container">
                <h2 class="section-title">Todas las Herramientas que Necesitas</h2>
                <div class="features-grid">
                    <div class="feature">
                        <h3>üñºÔ∏è Crea √Ålbumes</h3>
                        <p>Organiza tu contenido en √°lbumes tem√°ticos. F√°cil de crear, f√°cil de compartir con quien t√∫ decidas.</p>
                    </div>
                    <div class="feature">
                        <h3>#Ô∏è‚É£ Etiqueta tu Contenido</h3>
                        <p>Usa etiquetas para encontrar y clasificar tus fotos y videos. La b√∫squeda avanzada te permite filtrar por lo que m√°s te gusta.</p>
                    </div>
                    <div class="feature">
                        <h3>üîí Control Total</h3>
                        <p>T√∫ decides qui√©n ve tu contenido. Gestiona tus √°lbumes y tu perfil con total privacidad y seguridad.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="registro" class="cta-section">
            <div class="container">
                <h2>¬øListo para Empezar?</h2>
                <p>Crea tu cuenta gratuita y obt√©n acceso instant√°neo a todas las funcionalidades. Sube tu propio contenido, explora el de otros y √∫nete a la conversaci√≥n.</p>
                
                <form id="register-form" class="register-form">
                    <div id="register-message"></div>
                    <input type="text" name="username" placeholder="Nombre de usuario" required>
                    <input type="email" name="email" placeholder="Correo electr√≥nico" required>
                    <input type="password" name="password" placeholder="Contrase√±a" required>
                    <button type="submit" class="btn btn-primary btn-lg">Crear Mi Cuenta Ahora</button>
                </form>
            </div>
        </section>

    </main>

    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2025 Exponiendo Tacna. Todos los derechos reservados.</p>
            <nav class="footer-nav">
                <a href="#terminos">T√©rminos de Servicio</a>
                <a href="#privacidad">Pol√≠tica de Privacidad</a>
                <a href="#contacto">Contacto</a>
            </nav>
        </div>
    </footer>

    <div id="login-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Iniciar Sesi√≥n</h2>
            <form id="login-form">
                <div id="login-error-message" class="error-message" style="display: none;"></div>
                <input type="text" name="username" placeholder="Nombre de usuario" required>
                <input type="password" name="password" placeholder="Contrase√±a" required>
                <button type="submit" class="btn btn-primary">Entrar</button>
            </form>
        </div>
    </div>

    <div id="terms-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>T√©rminos de Servicio y Exenci√≥n de Responsabilidad</h2>
            <div class="terms-content">
                <p><strong>Uso exclusivo para mayores de 18 a√±os.</strong> Al acceder a este sitio, confirmas ser mayor de edad en tu jurisdicci√≥n.</p>
                <p>Todo el contenido multimedia presente en este sitio es subido y compartido exclusivamente por los usuarios. Los administradores no se hacen responsables por el material compartido por terceros.</p>
                <p>Para compartir cualquier contenido, el usuario declara y garantiza que tiene el permiso expl√≠cito y verificable de todas las personas que aparecen en dicho contenido.</p>
                <hr>
                <h3>Pol√≠tica de Tolerancia Cero Contra el Abuso Infantil</h3>
                <p>Este sitio web tiene una pol√≠tica de <strong>tolerancia cero, absoluta e innegociable</strong>, contra la pornograf√≠a infantil y cualquier forma de explotaci√≥n o abuso de menores. La distribuci√≥n de este material es un <strong>delito grave</strong>.</p>
                <p>Cualquier usuario que suba o comparta este tipo de contenido ser√° <strong>expulsado permanentemente</strong> y <strong>denunciado a las autoridades</strong> legales, entregando toda la informaci√≥n de registro disponible.</p>
            </div>
        </div>
    </div>

    <div id="privacy-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Pol√≠tica de Privacidad</h2>
            <div class="terms-content">
                <p><strong>Tu privacidad es nuestra prioridad.</strong> Nos comprometemos a proteger tus datos y a garantizar tu anonimato.</p>
                <p><strong>1. Datos Recopilados:</strong> √önicamente almacenamos tu nombre de usuario, correo electr√≥nico y contrase√±a encriptada. Te animamos a usar un seud√≥nimo para maximizar tu anonimato.</p>
                <p><strong>2. Seguridad:</strong> Utilizamos encriptaci√≥n y las mejores pr√°cticas de seguridad para proteger tu informaci√≥n. Tu contrase√±a se almacena de forma segura (hashed) y es inaccesible para nosotros.</p>
                <p><strong>3. No Compartimos tus Datos:</strong> Jam√°s venderemos o compartiremos tu informaci√≥n con terceros, excepto en caso de una orden judicial o para cooperar con autoridades en la investigaci√≥n de actividades ilegales graves.</p>
            </div>
        </div>
    </div>

    <div id="contact-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Contacto</h2>
            <div class="contact-content">
                <p>Para reportes, sugerencias o cualquier consulta, cont√°ctanos a trav√©s de nuestra cuenta oficial de Instagram.</p>
                <a href="https://www.instagram.com/exponiendo_tacna/" target="_blank" rel="noopener noreferrer" class="contact-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
                    <span>@exponiendo_tacna</span>
                </a>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // La URL de tu backend en Render
            const backendUrl = 'https://exponiendo-tacna-api2.onrender.com';
            
            // Inicializar todas las funcionalidades
            setupModals();
            setupForms(backendUrl);
            loadMostViewedAlbums(backendUrl);
        });

        // --- L√ìGICA DE MODALES ---
        function setupModals() {
            const modalTriggers = {
                'login-modal': 'a[href="#login"]',
                'terms-modal': 'a[href="#terminos"]',
                'privacy-modal': 'a[href="#privacidad"]',
                'contact-modal': 'a[href="#contacto"]'
            };

            for (const modalId in modalTriggers) {
                const modal = document.getElementById(modalId);
                const trigger = document.querySelector(modalTriggers[modalId]);
                const closeBtn = modal.querySelector('.close-button');

                if (modal && trigger) {
                    trigger.addEventListener('click', (e) => {
                        e.preventDefault();
                        modal.classList.add('is-visible');
                    });
                }
                
                if (modal && closeBtn) {
                    closeBtn.addEventListener('click', () => {
                        modal.classList.remove('is-visible');
                    });
                }
                
                if(modal) {
                    window.addEventListener('click', (e) => {
                        if (e.target == modal) {
                            modal.classList.remove('is-visible');
                        }
                    });
                }
            }
        }

        // --- L√ìGICA DE FORMULARIOS ---
        function setupForms(backendUrl) {
            const registerForm = document.getElementById('register-form');
            const loginForm = document.getElementById('login-form');
            
            if (loginForm) {
                const errorMessageDiv = document.getElementById('login-error-message');
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    errorMessageDiv.style.display = 'none';
                    const username = e.target.username.value;
                    const password = e.target.password.value;

                    fetch(`${backendUrl}/api/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password })
                    })
                    .then(response => response.json().then(data => ({ ok: response.ok, data })))
                    .then(({ ok, data }) => {
                        if (ok) {
                            localStorage.setItem('accessToken', data.access_token);
                            localStorage.setItem('username', data.username);
                            window.location.href = '/dashboard.html';
                        } else {
                            showError(errorMessageDiv, data.error || 'Ocurri√≥ un error inesperado.');
                        }
                    })
                    .catch(error => {
                        console.error('Error en la red:', error);
                        showError(errorMessageDiv, 'No se pudo conectar con el servidor.');
                    });
                });
            }

            if (registerForm) {
                const messageDiv = document.getElementById('register-message');
                registerForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    messageDiv.style.display = 'none';
                    const username = e.target.username.value;
                    const email = e.target.email.value;
                    const password = e.target.password.value;

                    fetch(`${backendUrl}/api/register`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, email, password })
                    })
                    .then(response => response.json().then(data => ({ ok: response.ok, data })))
                    .then(({ ok, data }) => {
                        if (ok) {
                            showMessage(messageDiv, data.message, 'success');
                            registerForm.reset();
                        } else {
                            showMessage(messageDiv, data.error, 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error en la red:', error);
                        showMessage(messageDiv, 'No se pudo conectar con el servidor.', 'error');
                    });
                });
            }
        }

        // --- L√ìGICA PARA CARGAR √ÅLBUMES ---
        function loadMostViewedAlbums(backendUrl) {
            const gridContainer = document.getElementById('album-grid-container');
            const apiUrl = `${backendUrl}/api/albums?sort_by=views_count&sort_order=desc&per_page=6`;
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) throw new Error('Error de red');
                    return response.json();
                })
                .then(data => {
                    gridContainer.innerHTML = '';
                    if (data.albums && data.albums.length > 0) {
                        data.albums.forEach(album => {
                            const thumbnailUrl = album.thumbnail_url || '/static/img/placeholder-default.jpg';
                            const profileUrl = `/profile.html?user=${album.owner_username}`;
                            const albumCard = document.createElement('div');
                            albumCard.className = 'album-card';
                            albumCard.innerHTML = `
                                <div class="album-card-thumbnail" style="background-image: url('${thumbnailUrl}');"></div>
                                <div class="album-info">
                                    <h3>${album.title}</h3>
                                    <p>por: <a href="${profileUrl}" class="profile-link">@${album.owner_username || 'usuario'}</a></p>
                                    <div class="album-stats"><span>üëÅÔ∏è ${album.views_count} vistas</span></div>
                                </div>`;
                            gridContainer.appendChild(albumCard);
                        });
                    } else {
                        gridContainer.innerHTML = '<p>A√∫n no hay √°lbumes para mostrar.</p>';
                    }
                }).catch(error => {
                    console.error('Error al cargar √°lbumes:', error);
                    gridContainer.innerHTML = '<p>No se pudieron cargar los √°lbumes.</p>';
                });
        }

        // --- FUNCIONES DE AYUDA ---
        function showError(element, message) {
            element.textContent = message;
            element.style.display = 'block';
        }

        function showMessage(element, message, type) {
            element.textContent = message;
            element.className = type === 'success' ? 'success-message' : 'error-message';
            element.style.display = 'block';
        }
    </script>
</body>
</html>

